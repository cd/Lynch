var Lynch=function(){"use strict";function r(t,e,n){t&&(this.selector=e||null,this.element=null,this.data=t.data||{},this.template=t.template||null,this.styles=t.styles||[],this.styleElements=[],this.created=t.created||null,this.beforeDestroy=t.beforeDestroy||null,this.store=n||{},this.childComponents=[],this.dataString=null)}return r.version="0.21.0",r.components={},r.utils={},r.debug=!1,r.disableRender=!1,r.prototype.render=function(t){if(!r.disableRender){var e={};for(var n in this.data)"_"!==n[0]&&(e[n]=this.data[n]);var o=JSON.stringify(e);return this.dataString===o?!1:(this.dataString=o,this.destroyChildComponents(!0),!(!this.element||!this.element.parentNode)&&(this.renderComponent(),this.createChildComponents(t),!0))}},r.prototype.destroyChildComponents=function(e){this.childComponents.forEach(function(t){t.destroy(e)}),this.childComponents=[]},r.prototype.destroy=function(t){var e;this.destroyChildComponents(!1),this.beforeDestroy&&this.beforeDestroy.call({data:this.data}),this.removeStyleElements(),r.debug&&console.log(this.selector+" destroyed"),t&&this.element&&this.element.parentNode&&(this.element.innerHTML="",e=this.element.cloneNode(!0),this.element.parentNode.replaceChild(e,this.element),r.debug&&console.log(this.selector+" removed from DOM"))},r.prototype.renderComponent=function(){var t,e,n;this.element.innerHTML=this.template.call({data:this.data}),r.debug&&(console.log(this.selector+" rendered"),t=Math.round(255*Math.random()),e=Math.round(255*Math.random()),n=Math.round(255*Math.random()),this.element.style.border="3px solid rgb("+t+", "+e+", "+n+")")},r.prototype.createChildComponents=function(t){t=t||[];var e=this.element.querySelectorAll("[data-lynch-comp]"),e=Array.prototype.slice.call(e);this.childComponents=[];for(var n=0;n<e.length;n++){var o=e[n].dataset.lynchComp||"",s=e[n].dataset.lynchId||null,i=null;t.forEach(function(t){o===t.component&&s===(t.id||null)&&(i=t.prop)}),this.createChildComponent(i,o,s)}},r.prototype.createChildComponent=function(t,e,n){var o='[data-lynch-comp="'+e+'"]';if(n&&(o+='[data-lynch-id="'+n+'"]'),!this.childComponents.filter(function(t){return t.selector===o}).length){r.debug&&console.log(this.selector+" creates child component "+o);var s=r.components[e];if("function"!=typeof s)throw new Error("Lynch Component '"+e+"' not found");var i=s(o,this.store);this.childComponents.push(i),i.create(this,t)}},r.prototype.bump=function(t,e,n){if(!r.disableRender){var o='[data-lynch-comp="'+e+'"]';n&&(o+='[data-lynch-id="'+n+'"]');for(var s=0;s<this.childComponents.length;s++)this.childComponents[s].selector===o&&(this.childComponents[s].destroy(!0),this.childComponents.splice(s,1));this.createChildComponent(t,e,n)}},r.prototype.addStyleElements=function(){var n=this.selector,t=this.element.dataset.lynchComp;if(!window.document.head.querySelector('[data-lynch-comp="'+t+'"]'))for(var e=0;e<this.styles.length;e++){var o=window.document.createElement("style");Array.isArray(this.styles[e].attributes)&&this.styles[e].attributes.forEach(function(t){o.setAttribute(t[0],t[1])}),o.dataset.lynchComp=t,window.document.head.appendChild(o),this.styles[e].rules.forEach(function(t){var e;-1===(t=t.trim()).indexOf("@")&&(e=t.split("{"),t=n+" "+e[0].replace(/,/g,","+n+" ")+"{"+e[1]),o.sheet.insertRule(t,o.sheet.cssRules.length)}),this.styleElements.push(o)}},r.prototype.removeStyleElements=function(){for(var t=0;t<this.styleElements.length;t++)window.document.head.removeChild(this.styleElements[t]);this.styleElements=[]},r.prototype.create=function(t,e){return t=t||{element:document,data:null},this.element=t.element.querySelector(this.selector),this.data._data=t.data,this.data._el=this.element,this.data._selector=this.selector,this.data._prop=e,this.addStyleElements(),this.created.call({data:this.data,render:this.render.bind(this),bump:this.bump.bind(this)}),this},r}();
