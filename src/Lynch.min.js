var Lynch=function(){"use strict";function l(e,t,n){e&&(this.selector=t||null,this.element=null,this.data=e.data||{},this.template=e.template||null,this.styles=e.styles||[],this.styleElements=[],this.created=e.created||null,this.beforeDestroy=e.beforeDestroy||null,this.store=n||{},this.childComponents=[])}return l.version="0.18.2",l.components={},l.utils={},l.debug=!1,l.disableRender=!1,l.prototype.render=function(e){if(!l.disableRender&&(this.destroyChildComponents(!0),this.element&&this.element.parentNode)){var t=this.renderComponent();return this.createChildComponents(e),t}},l.prototype.destroyChildComponents=function(t){this.childComponents.forEach(function(e){e.destroy(t)}),this.childComponents=[]},l.prototype.destroy=function(e){if(this.destroyChildComponents(!1),this.beforeDestroy&&this.beforeDestroy.call({data:this.data}),this.removeStyleElements(),l.debug&&console.log(this.selector+" destroyed"),e&&this.element&&this.element.parentNode){this.element.innerHTML="";var t=this.element.cloneNode(!0);this.element.parentNode.replaceChild(t,this.element),l.debug&&console.log(this.selector+" removed from DOM")}},l.prototype.renderComponent=function(){var e=this.template.call({data:this.data});return this.element.innerHTML!==e&&(this.element.innerHTML=e,l.debug&&console.log(this.selector+" rendered"),!0)},l.prototype.createChildComponents=function(e){e=e||[];var t=this.element.querySelectorAll("[data-lynch-comp]");t=Array.prototype.slice.call(t),this.childComponents=[];for(var n=0;n<t.length;n++){var s=t[n].dataset.lynchComp||"",o=t[n].dataset.lynchId||null,i=null;e.forEach(function(e){s===e.component&&o===(e.id||null)&&(i=e.prop)}),this.createChildComponent(i,s,o)}},l.prototype.createChildComponent=function(e,t,n){var s='[data-lynch-comp="'+t+'"]';if(n&&(s+='[data-lynch-id="'+n+'"]'),!this.childComponents.filter(function(e){return e.selector===s}).length){l.debug&&console.log(this.selector+" creates child component "+s);var o=l.components[t];if("function"!=typeof o)throw new Error("Lynch Component '"+t+"' not found");var i=o(s,this.store);this.childComponents.push(i),i.create(this,e)}},l.prototype.bump=function(e,t,n){if(!l.disableRender){var s='[data-lynch-comp="'+t+'"]';n&&(s+='[data-lynch-id="'+n+'"]');for(var o=0;o<this.childComponents.length;o++)this.childComponents[o].selector===s&&(this.childComponents[o].destroy(!0),this.childComponents.splice(o,1));this.createChildComponent(e,t,n)}},l.prototype.addStyleElements=function(){for(var t=this.selector,e=0;e<this.styles.length;e++){var n=window.document.createElement("style");Array.isArray(this.styles[e].attributes)&&this.styles[e].attributes.forEach(function(e){n.setAttribute(e[0],e[1])}),window.document.head.appendChild(n),this.styles[e].rules.forEach(function(e){n.sheet.insertRule(t+" "+e,n.sheet.cssRules.length)}),this.styleElements.push(n)}},l.prototype.removeStyleElements=function(){for(var e=0;e<this.styleElements.length;e++)window.document.head.removeChild(this.styleElements[e]);this.styleElements=[]},l.prototype.create=function(e,t){return e=e||{element:document,data:null},this.element=e.element.querySelector(this.selector),this.data._data=e.data,this.data._el=this.element,this.data._selector=this.selector,this.data._prop=t,this.addStyleElements(),this.created.call({data:this.data,render:this.render.bind(this),bump:this.bump.bind(this)}),this},l}();
