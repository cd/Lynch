var Lynch=function(){"use strict";function l(t,e,n){t&&(this.selector=e||null,this.element=null,this.data=t.data||{},this.template=t.template||null,this.styles=t.styles||[],this.styleElements=[],this.created=t.created||null,this.beforeDestroy=t.beforeDestroy||null,this.store=n||{},this.childComponents=[],this.dataString=null)}return l.version="0.19.0",l.components={},l.utils={},l.debug=!1,l.disableRender=!1,l.prototype.render=function(t){if(!l.disableRender){var e={};for(var n in this.data)"_"!==n[0]&&(e[n]=this.data[n]);var s=JSON.stringify(e);return this.dataString!==s&&(this.dataString=s,this.destroyChildComponents(!0),!(!this.element||!this.element.parentNode)&&(this.renderComponent(),this.createChildComponents(t),!0))}},l.prototype.destroyChildComponents=function(e){this.childComponents.forEach(function(t){t.destroy(e)}),this.childComponents=[]},l.prototype.destroy=function(t){if(this.destroyChildComponents(!1),this.beforeDestroy&&this.beforeDestroy.call({data:this.data}),this.removeStyleElements(),l.debug&&console.log(this.selector+" destroyed"),t&&this.element&&this.element.parentNode){this.element.innerHTML="";var e=this.element.cloneNode(!0);this.element.parentNode.replaceChild(e,this.element),l.debug&&console.log(this.selector+" removed from DOM")}},l.prototype.renderComponent=function(){this.element.innerHTML=this.template.call({data:this.data}),l.debug&&console.log(this.selector+" rendered")},l.prototype.createChildComponents=function(t){t=t||[];var e=this.element.querySelectorAll("[data-lynch-comp]");e=Array.prototype.slice.call(e),this.childComponents=[];for(var n=0;n<e.length;n++){var s=e[n].dataset.lynchComp||"",o=e[n].dataset.lynchId||null,i=null;t.forEach(function(t){s===t.component&&o===(t.id||null)&&(i=t.prop)}),this.createChildComponent(i,s,o)}},l.prototype.createChildComponent=function(t,e,n){var s='[data-lynch-comp="'+e+'"]';if(n&&(s+='[data-lynch-id="'+n+'"]'),!this.childComponents.filter(function(t){return t.selector===s}).length){l.debug&&console.log(this.selector+" creates child component "+s);var o=l.components[e];if("function"!=typeof o)throw new Error("Lynch Component '"+e+"' not found");var i=o(s,this.store);this.childComponents.push(i),i.create(this,t)}},l.prototype.bump=function(t,e,n){if(!l.disableRender){var s='[data-lynch-comp="'+e+'"]';n&&(s+='[data-lynch-id="'+n+'"]');for(var o=0;o<this.childComponents.length;o++)this.childComponents[o].selector===s&&(this.childComponents[o].destroy(!0),this.childComponents.splice(o,1));this.createChildComponent(t,e,n)}},l.prototype.addStyleElements=function(){for(var n=this.selector,t=0;t<this.styles.length;t++){var s=window.document.createElement("style");Array.isArray(this.styles[t].attributes)&&this.styles[t].attributes.forEach(function(t){s.setAttribute(t[0],t[1])}),window.document.head.appendChild(s),this.styles[t].rules.forEach(function(t){if(-1===(t=t.trim()).indexOf("@")){var e=t.split("{");t=n+" "+e[0].replace(/,/g,","+n+" ")+"{"+e[1]}s.sheet.insertRule(t,s.sheet.cssRules.length)}),this.styleElements.push(s)}},l.prototype.removeStyleElements=function(){for(var t=0;t<this.styleElements.length;t++)window.document.head.removeChild(this.styleElements[t]);this.styleElements=[]},l.prototype.create=function(t,e){return t=t||{element:document,data:null},this.element=t.element.querySelector(this.selector),this.data._data=t.data,this.data._el=this.element,this.data._selector=this.selector,this.data._prop=e,this.addStyleElements(),this.created.call({data:this.data,render:this.render.bind(this),bump:this.bump.bind(this)}),this},l}();